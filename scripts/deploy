#!/bin/sh

HOST=netboot.rstms.net

deploy() {

SRC=$1
DST=/var/www/netboot/$(basename $SRC)
echo "$SRC -> $DST"

ARGS=$(jq -c . <<EOF
{
    "src": "$SRC",
    "dest": "$DST",
    "owner": "root",
    "group": "wheel",
    "mode": "0644",
    "force": "true"
}
EOF
)

ansible \
    -i $HOST,\
    -e "@$HOME/.secrets/ansible_vault.yml" \
    --become-method=doas \
    --become \
    -a "$ARGS" \
    -m copy \
    $HOST
}

cp src/bin/ipxe.iso /mnt/beaker/h/vmware/iso/ipxe.iso
deploy src/bin/ipxe.iso
deploy menus/netboot-openbsd.ipxe
deploy menus/netboot-debian.ipxe
deploy menus/ipxe.png
